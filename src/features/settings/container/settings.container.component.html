<div class="modal-overlay" (click)="onBackdropClick()">
  <div class="modal-card modal-card--wide" (click)="$event.stopPropagation()">

    <!-- Header -->
    <div class="modal-header">
      <h2 class="modal-title">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
        –ù–∞—Å—Ç—Ä–æ–π–∫–∏
      </h2>
      <button class="modal-close" (click)="cancel()">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Tabs -->
    <div class="settings-tabs">
      <button [class.active]="activeTab === 'chat'" (click)="activeTab = 'chat'" class="settings-tab">
        üí¨ –ú–æ–¥–µ–ª—å —á–∞—Ç–∞
      </button>
      <button [class.active]="activeTab === 'embedding'" (click)="activeTab = 'embedding'" class="settings-tab">
        üìê –≠–º–±–µ–¥–¥–∏–Ω–≥–∏
      </button>
      <button [class.active]="activeTab === 'speech'" (click)="activeTab = 'speech'" class="settings-tab">
        üé§ –†–µ—á—å
      </button>
      <button [class.active]="activeTab === 'guide'" (click)="activeTab = 'guide'" class="settings-tab">
        üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
      </button>
    </div>

    <!-- Body -->
    <div class="modal-body">

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB: CHAT MODEL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      @if (activeTab === 'chat') {
        <app-provider-config
          type="chat"
          [providers]="providers"
          [selectedProviderId]="selectedChatProvider"
          [providerInfo]="activeChatProviderInfo"
          [baseUrl]="chatBaseUrl"
          [apiKey]="chatApiKey"
          [modelId]="chatModelId"
          [showKey]="showChatKey"
          [showDropdown]="showChatDropdown"
          [filterText]="chatFilterText"
          [fetchedModels]="fetchedChatModels()"
          [filteredFetched]="filteredFetchedChat()"
          [filteredPreset]="filteredPresetChat()"
          [isFetching]="isFetchingChat()"
          [status]="chatStatus()"
          [hasError]="chatError()"
          (providerSelected)="selectChatProvider($event)"
          (baseUrlChange)="chatBaseUrl = $event"
          (apiKeyChange)="chatApiKey = $event"
          (modelIdChange)="chatModelId = $event"
          (showKeyChange)="showChatKey = $event"
          (showDropdownChange)="showChatDropdown = $event"
          (filterTextChange)="chatFilterText = $event"
          (checkModels)="checkChatModels()"
          sectionTitle="–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä —á–∞—Ç-–º–æ–¥–µ–ª–∏">
        </app-provider-config>
      }

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB: EMBEDDING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      @if (activeTab === 'embedding') {
        <app-provider-config
          type="embedding"
          [providers]="embeddingProviders"
          [selectedProviderId]="selectedEmbedProvider"
          [providerInfo]="activeEmbedProviderInfo"
          [baseUrl]="embedBaseUrl"
          [apiKey]="embedApiKey"
          [modelId]="embedModelId"
          [showKey]="showEmbedKey"
          [showDropdown]="showEmbedDropdown"
          [filterText]="embedFilterText"
          [fetchedModels]="fetchedEmbedModels()"
          [filteredFetched]="filteredFetchedEmbed()"
          [filteredPreset]="filteredPresetEmbed()"
          [isFetching]="isFetchingEmbed()"
          [status]="embedStatus()"
          [hasError]="embedError()"
          (providerSelected)="selectEmbedProvider($event)"
          (baseUrlChange)="embedBaseUrl = $event"
          (apiKeyChange)="embedApiKey = $event"
          (modelIdChange)="embedModelId = $event"
          (showKeyChange)="showEmbedKey = $event"
          (showDropdownChange)="showEmbedDropdown = $event"
          (filterTextChange)="embedFilterText = $event"
          (checkModels)="checkEmbedModels()"
          sectionTitle="–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤"
          hint="–≠–º–±–µ–¥–¥–∏–Ω–≥–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º —Ñ–∞–π–ª–∞–º (RAG). –î–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è Ollama.">
        </app-provider-config>
      }

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB: SPEECH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      @if (activeTab === 'speech') {
        <app-speech-config
          [sttProvider]="sttProvider"
          [sttApiKey]="sttApiKey"
          [sttModel]="sttModel"
          [sttBaseUrl]="sttBaseUrl"
          [sttLanguage]="sttLanguage"
          [ttsProvider]="ttsProvider"
          [ttsApiKey]="ttsApiKey"
          [ttsModel]="ttsModel"
          [ttsVoice]="ttsVoice"
          [ttsBaseUrl]="ttsBaseUrl"
          [ttsRate]="ttsRate"
          (sttProviderChange)="sttProvider = $event"
          (sttApiKeyChange)="sttApiKey = $event"
          (sttModelChange)="sttModel = $event"
          (sttBaseUrlChange)="sttBaseUrl = $event"
          (sttLanguageChange)="sttLanguage = $event"
          (ttsProviderChange)="ttsProvider = $event"
          (ttsApiKeyChange)="ttsApiKey = $event"
          (ttsModelChange)="ttsModel = $event"
          (ttsVoiceChange)="ttsVoice = $event"
          (ttsBaseUrlChange)="ttsBaseUrl = $event"
          (ttsRateChange)="ttsRate = $event">
        </app-speech-config>
      }

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB: GUIDE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      @if (activeTab === 'guide') {
        <app-setup-guide></app-setup-guide>
      }

    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <button class="btn-cancel" (click)="cancel()">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn-save" (click)="save()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>

  </div>
</div>
