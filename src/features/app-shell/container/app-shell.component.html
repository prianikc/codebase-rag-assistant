<div class="app-shell" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)">
  <!-- Drop Overlay -->
  @if (isDragging()) {
    <div class="drop-overlay">
      <div class="drop-overlay-content">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
        </svg>
        <p>Перетащите файлы или папки сюда</p>
      </div>
    </div>
  }

  <!-- Sidebar with variable width -->
  <app-sidebar-container 
    class="sidebar" 
    [style.width.px]="sidebarWidth()"
    [style.min-width.px]="sidebarWidth()"
    (openInstructions)="showInstructions.set(true)">
  </app-sidebar-container>

  <!-- Sidebar Resize Handle -->
  <div class="resize-handle resize-handle-sidebar" (mousedown)="onResizeSidebarStart($event)"></div>

  <!-- File Viewer Panel (shown when a file is open) -->
  @if (fileViewerService.isOpen()) {
    <div class="file-viewer-area" [style.width.px]="viewerWidth()">
      <app-file-viewer
        (close)="fileViewerService.closeViewer()"
        (insertToChat)="pendingSnippet.set($event)">
      </app-file-viewer>
    </div>

    <!-- Viewer Resize Handle -->
    <div class="resize-handle resize-handle-viewer" (mousedown)="onResizeViewerStart($event)"></div>
  }

  <main class="main-content">
    <app-chat-container [pendingSnippet]="pendingSnippet()" (snippetConsumed)="pendingSnippet.set('')"></app-chat-container>
  </main>

  <!-- Project Instructions Modal -->
  @if (showInstructions()) {
    <app-project-instructions-container (closeModal)="showInstructions.set(false)">
    </app-project-instructions-container>
  }
</div>
